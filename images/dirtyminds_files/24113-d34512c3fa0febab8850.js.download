"use strict";(self.webpackChunkSHEIN_W=self.webpackChunkSHEIN_W||[]).push([[24113],{670732:function(t,e,n){n.d(e,{P:function(){return i}});const i=({func:t,wait:e=0,options:n={}})=>{const{leading:i=!0,trailing:s=!0}=n;let o,r,l,c,a=0,h=0;function d(e){const n=o,i=r;return o=r=void 0,a=e,t.apply(n,i)}const u=function(...t){r=t,o=this;const n=(new Date).getTime(),u=n-h;return h=n,new Promise((t=>{(!a||u>=e)&&!1===i&&(a=n);const o=e-(n-a);o<=0||o>e?(c&&(clearTimeout(c),c=null),l=d(n),t(l)):c||!1===s||(c=setTimeout((()=>{a=!1===i?0:(new Date).getTime(),c=null,l=d(a),t(l)}),o))}))};return u.cancel=function(){c&&clearTimeout(c),c=null,h=a=0,o=r=void 0},u}},882065:function(t,e,n){n.d(e,{is:function(){return s}});const i=Object.prototype.toString;function s(t,e){return i.call(t)===`[object ${e}]`}},76520:function(t,e,n){n.d(e,{K:function(){return s}});var i=n(882065);function s(t){return null!==t&&(0,i.is)(t,"Object")}},424113:function(t,e,n){n.d(e,{Ch:function(){return I},Xs:function(){return m},ZC:function(){return k}});var i=n(76520),s=n(670732),o=n(149500),r=Object.defineProperty,l=(t,e,n)=>(((t,e,n)=>{e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const c=t=>{var e;if("undefined"==typeof window)return null;return{container:t.scrollContainer?t.scrollContainer instanceof HTMLElement?t.scrollContainer:document.querySelector(t.scrollContainer):window,key:[null==(e=t.mask)?void 0:e.map((t=>parseFloat(String(t)))).join(""),t.delay,t.exposeRatio,t.observeHide?"obHide":""].join("")}},a={cache:new Map,get(t){const e=(this.cache.get(t.container)||[]).find((e=>e.key==t.key));return e?e.instance:null},set(t){const e=this.cache.get(t.container)||[];e.find((e=>e.key==t.key))||(e.push({key:t.key,instance:t.instance}),this.cache.set(t.container,e))},del(t){if(t.key){const e=this.cache.get(t.container)||[],n=e.findIndex((e=>e.key==t.key));e.splice(n,1),e.length?this.cache.set(t.container,e):this.cache.delete(t.container)}else this.cache.delete(t.container)}},h={IDKEY:"da-eid",REPEATKEY:"da-rid"},d=t=>{if("undefined"==typeof window||!t)return"";if("string"==typeof t)return t;if(t instanceof HTMLElement){const e=t.getAttribute(h.IDKEY);return`[${h.IDKEY}=${e}]`}if((0,i.K)(t))return t.target instanceof HTMLElement?{code:(null==t?void 0:t.code)||"",target:d(t.target)}:t;if(t.length){const e=t[0].classList;return Array.prototype.map.call(e,(t=>`.${t}`)).join("")}return""},u=t=>"undefined"!=typeof window&&t?t instanceof HTMLElement?[t]:"string"==typeof t?Array.prototype.slice.call(document.querySelectorAll(t)):(0,i.K)(t)?u(t.target):t.length?Array.prototype.slice.call(t):[t]:[],p=()=>Number(Math.random().toString().substr(3,3)+Date.now()).toString(36),f=(t,e)=>{let n;switch(t){case"error":n=o.error;break;case"warn":n=o.warn;break;default:n=o.info}"undefined"!=typeof window&&n(e)},g=t=>{if(!t)return{};const{top:e=0,bottom:n=0,right:i=0,left:s=0}=t.getBoundingClientRect&&t.getBoundingClientRect()||{};return{top:e,bottom:n,right:i,left:s,height:t.offsetHeight||t.innerHeight,width:t.offsetWidth||t.innerWidth}},v=(t,e)=>{if(!t||!e)return!1;let n=t,s=e,o=0;const r=[0,0,0,0];if((0,i.K)(t)&&(n=t.el,o=t.ratio||0),(0,i.K)(e)&&(s=e.el,e.mask&&Array.isArray(e.mask)&&e.mask.filter(((t,e)=>{r[e]=parseInt(String(t))}))),!n||!s)return!1;const{top:l=0,left:c=0,right:a=0,bottom:h=0,width:d=0,height:u=0}=g(n);if(0==d||0==u)return!1;const{top:p=0,left:f=0,width:v=0,height:b=0}=g(s),m=v+f-r[1],E=p+b-r[2],w=p+r[0],y=f+r[3];return!(l>=E-u*o||h<=w+u*o)&&!(a<=y+d*o||c>=m-d*o)},{IDKEY:b}=h;class m{constructor(t,e){l(this,"initParams"),l(this,"intersectionObFn"),l(this,"listenerEvent"),l(this,"scrollProgress",-1),l(this,"scrollCbFn",[]),l(this,"listenAddScroll",new Map),l(this,"listenMap",new Map),l(this,"scrollContainer"),"undefined"!=typeof window&&((null==e?void 0:e.fromExpose)&&f("info","scroll event from expose❗️"),this.initParams=e,this.intersectionObFn=t,this.scrollContainer=(null==e?void 0:e.scrollContainer)?u(null==e?void 0:e.scrollContainer)[0]:window,this.init())}init(){var t;this.listenerEvent=this.createListener(this.handelScrollEvent),null==(t=this.scrollContainer)||t.addEventListener("scroll",this.listenerEvent.bind(this),!1)}createListener(t,e){return void 0===t?()=>{}:e&&e>0?(0,s.P)({func:t,wait:e,options:{trailing:!1}}):t}handelScrollEvent(t){this.listenScroll(t),"function"==typeof this.intersectionObFn&&this.listenMap.size&&this.listenerEl()}listenerEl(){var t;const e=[];this.listenMap.forEach((t=>{const n=this._withInArea(t.target);t.isIntersecting!==n&&(this.listenMap.set(t.id,Object.assign(t,{isIntersecting:n})),e.push({isIntersecting:n,target:t.target}))})),e.length&&(null==(t=this.intersectionObFn)||t.call(this,e))}_withInArea(t){var e,n;return v({el:t,ratio:(null==(e=this.initParams)?void 0:e.exposeRatio)||0},{el:this.scrollContainer||window,mask:(null==(n=this.initParams)?void 0:n.mask)||[0,0,0,0]})}listenScroll(t){if(!this.scrollCbFn.length)return;const e=this.scrollContainer===window?Math.abs(g(document.body).top||0):this.scrollContainer.scrollTop||0,n=e-this.scrollProgress;if(0===n)return;const i={scrollTop:e,type:n>0?"down":"up"};this.scrollProgress=e,this.scrollCbFn.forEach((e=>e(i,t)))}listen(t,e){if("function"==typeof t){const n=p(),i=this.createListener(t,null==e?void 0:e.delay);return this.listenAddScroll.set(n,i),this.scrollCbFn.push(i),n}}unListen(t){if(t&&this.listenAddScroll.has(t)){this.listenAddScroll.delete(t);const e=[];this.listenAddScroll.forEach((t=>{e.push(t)})),this.scrollCbFn=e}}observe(t){if(!t)return;let e=t.getAttribute(b);e&&this.listenMap.has(e)||(e||(e=p(),t.setAttribute(b,e)),this.listenMap.set(e,{id:e,isIntersecting:!1,target:t}))}unobserve(t){if(!t)return;const e=t.getAttribute(b);e&&this.listenMap.delete(e)}disconnect(){this.listenerEvent&&window.removeEventListener("scroll",this.listenerEvent,!1)}}class E{constructor(t,e){l(this,"evt",null),l(this,"initOption"),l(this,"handleExposeEvent",[]),l(this,"scrollContainer"),l(this,"io",null),this.initOption=t||null,"undefined"!=typeof window&&(this.scrollContainer=(null==t?void 0:t.scrollContainer)?u(null==t?void 0:t.scrollContainer)[0]:null,this.init(e))}init(t){var e,n,i,s,o;if(this.evt=((t,e)=>{if("function"==typeof window.CustomEvent)return new CustomEvent(t,e);e=e||{bubbles:!1,cancelable:!1,detail:null};const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n})("scroll",{bubbles:!1,cancelable:!1}),window.hasOwnProperty("IntersectionObserver")){const s=(null==(n=null==(e=this.initOption)?void 0:e.mask)?void 0:n.map((t=>-(parseInt(String(t))||0)+"px")).join(" "))||"0px 0px 0px 0px";this.io=new IntersectionObserver(t,{root:this.scrollContainer||null,rootMargin:s,threshold:[(null==(i=this.initOption)?void 0:i.exposeRatio)||0]}),this.scrollContainer=this.scrollContainer||window}else{const e=this.scrollContainer||window;this.scrollContainer=e,this.io=new m(t,{scrollContainer:e,exposeRatio:(null==(s=this.initOption)?void 0:s.exposeRatio)||0,mask:null==(o=this.initOption)?void 0:o.mask})}}triggerScroll(){(0,s.P)({func:()=>{var t;null==(t=this.scrollContainer)||t.dispatchEvent(this.evt)},wait:300,options:{trailing:!1}})}destroy(){var t;null==(t=this.io)||t.disconnect()}}const{IDKEY:w,REPEATKEY:y}=h;class I{constructor(t){l(this,"hasBeenExposeId",new Map),l(this,"initParams"),l(this,"scrollInstance",null),l(this,"singleBlockObMap",new Map),l(this,"intersectionIoMap",new Map),l(this,"intersectionTempExpose",new Set),l(this,"timer"),l(this,"logFn",(()=>{})),this.initParams=t,void 0!==typeof window&&this.init(t)}init(t){this.scrollInstance=new E({scrollContainer:null==t?void 0:t.scrollContainer,exposeRatio:null==t?void 0:t.exposeRatio,delay:null==t?void 0:t.delay,mask:null==t?void 0:t.mask},this.intersectionObserverCallback.bind(this)),this.logFn=(null==t?void 0:t.log)?f:()=>{}}intersectionObserverCallback(t){t.forEach((t=>{var e;const n=t.target;if(t.isIntersecting){const{delay:t=1e3}=this.initParams||{};this.intersectionTempExpose.add(n),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.intersectionPreExpose([...this.intersectionTempExpose]),this.intersectionTempExpose.clear()}),t)}else(null==(e=this.initParams)?void 0:e.observeHide)&&this.sendHideEvent(n)}))}intersectionPreExpose(t){if(!t.length)return;const e={};t.forEach((t=>{if(!this._withInArea(t))return;const n=t.getAttribute(w),i=this.intersectionIoMap.get(n);i&&(e[i.code]||(e[i.code]={info:i,exposeDoms:[]}),e[i.code].exposeDoms.push(t))}));for(const t in e){const n=e[t];n.exposeDoms.length&&this.sendExposeEvent(n.info,n.exposeDoms)}}sendHideEvent(t){if(!t)return;const e=t.getAttribute(w),n=this.intersectionIoMap.get(e);if(!n)return;const{code:i,handle:s}=n;s({code:i,exposeDoms:[],hideDoms:[t]})}sendExposeEvent(t,e){const{code:n,once:i,handle:s,middleJudge:o}=t,r=e.filter((t=>{const e=this.hasBeenExposeId.get(n)||new Set,s=t.getAttribute(w)||"",r=t.getAttribute(y)||"",l=r?e.has(r):e.has(s);if(l)i&&this.removeElements([t]);else{if("function"==typeof o&&!o(t,n))return!1;i&&(e.add(s),r&&e.add(r),this.hasBeenExposeId.set(n,e),this.removeElements([t]))}return!l}));r.length&&s({code:n,hideDoms:[],exposeDoms:r})}_withInArea(t){var e,n,i;return v({el:t,ratio:(null==(e=this.initParams)?void 0:e.exposeRatio)||0},{el:null==(n=this.scrollInstance)?void 0:n.scrollContainer,mask:(null==(i=this.initParams)?void 0:i.mask)||[0,0,0,0]})}addEleObId(t){return t.filter((t=>{if(t&&1==t.nodeType){if(!t.getAttribute(w)){const e=p();t.setAttribute(w,e)}return!0}}))}singleBlock(t,e){const n=t.elements,i=(null==t?void 0:t.code)||(null==n?void 0:n.code)||`${p()}_code`,s={code:i,handle:e,once:void 0===t.once||t.once,middleJudge:null==t?void 0:t.middleJudge,elements:"",ids:new Set};let o=this.addEleObId(u(n));if(!o.length)return;const r=this.hasBeenExposeId.get(s.code);if(o=o.filter((t=>{const e=t.getAttribute(w)||"";return!(r&&r.has(e)||this.intersectionIoMap.has(e))})),!o.length)return this.logFn("warn","[basis-expose]: 未查询到元素，请检查元素是否[已曝光｜未创建]");s.elements=d(n),this.singleBlockObMap.has(i)||this.singleBlockObMap.set(i,Object.assign({},s));const l=o.map((t=>null==t?void 0:t.getAttribute(w))).filter((t=>!!t)),c=this.singleBlockObMap.get(i)||{};l.forEach((t=>{c.ids.add(t)})),this.singleBlockObMap.set(i,c),this.addToIntersectionOb(o,Object.assign({},s,{ids:null}))}multiBlock(t,e){const n=t.section;if(!n||!n.length)return this.logFn("warn","[basis-expose]: multiBlock - 请传入正确的 section 格式");n.filter((t=>!!t.target)).forEach((n=>{const{container:i,content:s,target:o,code:r}=n,l=r||`${p()}_code`,c=[i,s,o].filter((t=>!!t)).join(" ");this.singleBlock({...t,elements:{code:l,target:c}},e)}))}addToIntersectionOb(t,e){t.forEach((t=>{var n;const i=t.getAttribute(w);if(this.intersectionIoMap.has(i))return;const s=t.getAttribute(y);if(e.code&&s){const t=this.hasBeenExposeId.get(e.code);if(t&&t.has(s))return}this.intersectionIoMap.set(i,e),null==(n=this.scrollInstance)||n.io.observe(t)}))}removeElements(t){var e,n,i;if(!t||!t.length)return this.logFn("warn","[basis-expose]: removeElements - 元素应该给数组类型");for(const s of t){null==(e=this.scrollInstance)||e.io.unobserve(s);const t=s.getAttribute(w),o=this.intersectionIoMap.get(t),r=this.singleBlockObMap.get(o.code);null==(i=null==(n=null==r?void 0:r.ids)?void 0:n.delete)||i.call(n,t),this.intersectionIoMap.delete(t)}}observe(t,e){if(!t)return;const{elements:n,section:i}=t;n||i?(n&&(Array.isArray(n)?n.forEach((n=>{this.singleBlock({...t,elements:n},e)})):this.singleBlock(t,e)),i&&i.length&&this.multiBlock(t,e),this.triggerScroll()):this.logFn("info","[basis-expose]: observe - 缺少元素|选择器")}update(t){if(!t)return this.logFn("warn","[basis-expose]: update - 方法缺少code");t.split(",").forEach((t=>{const e=this.singleBlockObMap.get(t);if(e){const{handle:t}=e;this.singleBlock(e,t)}})),this.triggerScroll()}remove(t){if(!t)return this.logFn("warn","[basis-expose]: remove - 方法缺少code");t.split(",").forEach((t=>{const e=this.singleBlockObMap.get(t);if(e){const n=e.ids;(null==n?void 0:n.size)>0&&n.forEach((t=>{this.intersectionIoMap.delete(t)})),this.singleBlockObMap.delete(t)}this.hasBeenExposeId.delete(t)}))}reset(t){if(!t)return this.logFn("warn","[basis-expose]: reset - 方法缺少code");const e=this.hasBeenExposeId.get(t);e&&(this.hasBeenExposeId.delete(t),[...e].forEach((e=>{const n=u(`[${w}="${e}"]`);if(!n)return;const i=this.singleBlockObMap.get(t);i&&this.singleBlock({...i,elements:{code:t,target:n}},i.handle)})),this.triggerScroll())}resetAll(t){var e;if(this.hasBeenExposeId.size>0){let n=[...this.hasBeenExposeId];t&&("function"==typeof t&&(n=t(n)),"string"==typeof t&&(n=null==(e=null==n?void 0:n.filter)?void 0:e.call(n,(e=>!!e.length&&e[0].startsWith(t))))),n.map((t=>t[0])).forEach((t=>{this.reset(t)}))}}destroy(){var t;null==(t=this.scrollInstance)||t.destroy();const e=c(this.initParams||{});e&&a.del(e)}triggerScroll(){var t;null==(t=this.scrollInstance)||t.triggerScroll()}}const k=t=>{const e=c(t||{});if(e){const t=a.get(e);if(t)return t}const n=new I(t);return e&&a.set(Object.assign(e,{instance:n})),n}}}]);